<div *ngIf="loading" style="text-align: center;">
  <mat-spinner></mat-spinner>
</div>

<div *ngIf="!loading && student">
  <button mat-icon-button (click)="goBack()" style="margin-bottom: 10px;">
    <mat-icon>arrow_back</mat-icon>
  </button>

  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ student.fullName || (student.firstName + ' ' + student.lastName) }}</mat-card-title>
      <button mat-icon-button color="accent" (click)="editStudent()">
        <mat-icon>edit</mat-icon>
      </button>
    </mat-card-header>
    <mat-card-content>
      <mat-tab-group>
        <mat-tab label="Basic Info">
          <div class="tab-content">
            <table class="detail-table">
              <tr>
                <th>Admission Number</th>
                <td>{{ student.admissionNo }}</td>
                <th>Date of Birth</th>
                <td>{{ student.dateOfBirth | date }}</td>
              </tr>
              <tr>
                <th>Gender</th>
                <td>{{ student.gender }}</td>
                <th>Blood Group</th>
                <td>{{ student.bloodGroup }}</td>
              </tr>
              <tr>
                <th>Phone</th>
                <td>{{ student.phone }}</td>
                <th>Email</th>
                <td>{{ student.email }}</td>
              </tr>
              <tr>
                <th>Religion</th>
                <td>{{ student.religion }}</td>
                <th>Caste</th>
                <td>{{ student.caste }}</td>
              </tr>
              <tr>
                <th>Nationality</th>
                <td>{{ student.nationality }}</td>
                <th>Mother Tongue</th>
                <td>{{ student.motherTongue }}</td>
              </tr>
              <tr>
                <th>Aadhar Number</th>
                <td>{{ student.aadharNo }}</td>
                <th>Status</th>
                <td>{{ student.status }}</td>
              </tr>
              <tr *ngIf="student.medicalConditions">
                <th>Medical Conditions</th>
                <td colspan="3">{{ student.medicalConditions }}</td>
              </tr>
              <tr *ngIf="student.allergies">
                <th>Allergies</th>
                <td colspan="3">{{ student.allergies }}</td>
              </tr>
              <tr *ngIf="student.remarks">
                <th>Remarks</th>
                <td colspan="3">{{ student.remarks }}</td>
              </tr>
            </table>
          </div>
        </mat-tab>

        <mat-tab label="Guardians">
          <div class="tab-content">
            <table mat-table [dataSource]="guardians" class="full-width" *ngIf="guardians.length > 0">
              <ng-container matColumnDef="relation">
                <th mat-header-cell *matHeaderCellDef>Relation</th>
                <td mat-cell *matCellDef="let guardian">{{ guardian.relation }}</td>
              </ng-container>

              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let guardian">{{ guardian.name }}</td>
              </ng-container>

              <ng-container matColumnDef="phone">
                <th mat-header-cell *matHeaderCellDef>Phone</th>
                <td mat-cell *matCellDef="let guardian">{{ guardian.phone }}</td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef>Email</th>
                <td mat-cell *matCellDef="let guardian">{{ guardian.email }}</td>
              </ng-container>

              <ng-container matColumnDef="occupation">
                <th mat-header-cell *matHeaderCellDef>Occupation</th>
                <td mat-cell *matCellDef="let guardian">{{ guardian.occupation }}</td>
              </ng-container>

              <ng-container matColumnDef="isPrimary">
                <th mat-header-cell *matHeaderCellDef>Primary Contact</th>
                <td mat-cell *matCellDef="let guardian">{{ guardian.isPrimary ? 'Yes' : 'No' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['relation', 'name', 'phone', 'email', 'occupation', 'isPrimary']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['relation', 'name', 'phone', 'email', 'occupation', 'isPrimary'];"></tr>
            </table>
            <p *ngIf="guardians.length === 0" style="margin: 20px;">No guardians added yet.</p>
          </div>
        </mat-tab>

        <mat-tab label="Enrollments">
          <div class="tab-content">
            <table mat-table [dataSource]="enrollments" class="full-width" *ngIf="enrollments.length > 0">
              <ng-container matColumnDef="academicYear">
                <th mat-header-cell *matHeaderCellDef>Academic Year</th>
                <td mat-cell *matCellDef="let enrollment">{{ enrollment.academicYear }}</td>
              </ng-container>

              <ng-container matColumnDef="className">
                <th mat-header-cell *matHeaderCellDef>Class</th>
                <td mat-cell *matCellDef="let enrollment">{{ enrollment.className }}</td>
              </ng-container>

              <ng-container matColumnDef="sectionName">
                <th mat-header-cell *matHeaderCellDef>Section</th>
                <td mat-cell *matCellDef="let enrollment">{{ enrollment.sectionName }}</td>
              </ng-container>

              <ng-container matColumnDef="rollNumber">
                <th mat-header-cell *matHeaderCellDef>Roll Number</th>
                <td mat-cell *matCellDef="let enrollment">{{ enrollment.rollNumber }}</td>
              </ng-container>

              <ng-container matColumnDef="enrollmentStatus">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let enrollment">{{ enrollment.enrollmentStatus }}</td>
              </ng-container>

              <ng-container matColumnDef="enrollmentDate">
                <th mat-header-cell *matHeaderCellDef>Enrollment Date</th>
                <td mat-cell *matCellDef="let enrollment">{{ enrollment.enrollmentDate | date }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['academicYear', 'className', 'sectionName', 'rollNumber', 'enrollmentStatus', 'enrollmentDate']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['academicYear', 'className', 'sectionName', 'rollNumber', 'enrollmentStatus', 'enrollmentDate'];"></tr>
            </table>
            <p *ngIf="enrollments.length === 0" style="margin: 20px;">No enrollments found.</p>
          </div>
        </mat-tab>

        <!-- Addresses Tab -->
        <mat-tab label="Addresses">
          <div style="padding: 20px;">
            <table mat-table [dataSource]="addresses" *ngIf="addresses.length > 0" class="mat-elevation-z2" style="width: 100%;">
              <ng-container matColumnDef="addressType">
                <th mat-header-cell *matHeaderCellDef>Type</th>
                <td mat-cell *matCellDef="let address">{{ address.addressType }}</td>
              </ng-container>

              <ng-container matColumnDef="line1">
                <th mat-header-cell *matHeaderCellDef>Address Line 1</th>
                <td mat-cell *matCellDef="let address">{{ address.line1 }}</td>
              </ng-container>

              <ng-container matColumnDef="line2">
                <th mat-header-cell *matHeaderCellDef>Address Line 2</th>
                <td mat-cell *matCellDef="let address">{{ address.line2 || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="city">
                <th mat-header-cell *matHeaderCellDef>City</th>
                <td mat-cell *matCellDef="let address">{{ address.city }}</td>
              </ng-container>

              <ng-container matColumnDef="state">
                <th mat-header-cell *matHeaderCellDef>State</th>
                <td mat-cell *matCellDef="let address">{{ address.state }}</td>
              </ng-container>

              <ng-container matColumnDef="pincode">
                <th mat-header-cell *matHeaderCellDef>Pincode</th>
                <td mat-cell *matCellDef="let address">{{ address.pincode }}</td>
              </ng-container>

              <ng-container matColumnDef="country">
                <th mat-header-cell *matHeaderCellDef>Country</th>
                <td mat-cell *matCellDef="let address">{{ address.country }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['addressType', 'line1', 'line2', 'city', 'state', 'pincode', 'country']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['addressType', 'line1', 'line2', 'city', 'state', 'pincode', 'country'];"></tr>
            </table>
            <p *ngIf="addresses.length === 0" style="margin: 20px;">No addresses found.</p>
          </div>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>
