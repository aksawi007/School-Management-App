<mat-card class="form-container">
  <mat-card-header>
    <mat-card-title>{{ isEditMode ? 'Edit Student' : 'Add New Student' }}</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="studentForm" (ngSubmit)="onSubmit()">
      <!-- Basic Information -->
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Basic Information</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Admission Number (Optional - Auto-generated)</mat-label>
            <input matInput formControlName="admissionNo">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>First Name</mat-label>
            <input matInput formControlName="firstName" required>
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Middle Name</mat-label>
            <input matInput formControlName="middleName">
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Last Name</mat-label>
            <input matInput formControlName="lastName" required>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Date of Birth</mat-label>
            <input matInput [matDatepicker]="dobPicker" formControlName="dateOfBirth" required>
            <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
            <mat-datepicker #dobPicker></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Gender</mat-label>
            <mat-select formControlName="gender" required>
              <mat-option *ngFor="let gender of genders" [value]="gender">{{gender}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Blood Group</mat-label>
            <mat-select formControlName="bloodGroup">
              <mat-option *ngFor="let bloodGroup of bloodGroups" [value]="bloodGroup">{{bloodGroup}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Contact Information -->
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Contact Information</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Phone Number</mat-label>
            <input matInput formControlName="phone">
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email">
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Personal Details -->
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Personal Details</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Religion</mat-label>
            <mat-select formControlName="religion">
              <mat-option *ngFor="let religion of religions" [value]="religion">{{religion}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Caste Category</mat-label>
            <mat-select formControlName="caste">
              <mat-option *ngFor="let caste of casteCategories" [value]="caste">{{caste}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Nationality</mat-label>
            <mat-select formControlName="nationality" required>
              <mat-option *ngFor="let nationality of nationalities" [value]="nationality">{{nationality}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Mother Tongue</mat-label>
            <input matInput formControlName="motherTongue">
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Aadhar Number</mat-label>
            <input matInput formControlName="aadharNo">
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Admission Details -->
      <mat-expansion-panel [expanded]="true">
        <mat-expansion-panel-header>
          <mat-panel-title>Admission Details</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div class="form-row">
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Admission Date</mat-label>
            <input matInput [matDatepicker]="admPicker" formControlName="admissionDate" required>
            <mat-datepicker-toggle matSuffix [for]="admPicker"></mat-datepicker-toggle>
            <mat-datepicker #admPicker></mat-datepicker>
          </mat-form-field>
          <mat-form-field appearance="outline" style="flex: 1;">
            <mat-label>Photo URL</mat-label>
            <input matInput formControlName="photoUrl">
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Remarks</mat-label>
            <textarea matInput formControlName="remarks" rows="3"></textarea>
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Medical Information -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Medical Information</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Medical Conditions</mat-label>
            <textarea matInput formControlName="medicalConditions" rows="3"></textarea>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Allergies</mat-label>
            <textarea matInput formControlName="allergies" rows="3"></textarea>
          </mat-form-field>
        </div>
      </mat-expansion-panel>

      <!-- Guardian Information -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Guardian Information</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div formArrayName="guardians">
          <div *ngFor="let guardian of guardians.controls; let i = index" [formGroupName]="i" class="guardian-section">
            <mat-card>
              <mat-card-header>
                <mat-card-title>Guardian {{i + 1}}</mat-card-title>
                <button mat-icon-button color="warn" type="button" (click)="removeGuardian(i)" *ngIf="guardians.length > 0">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-header>
              <mat-card-content>
                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Relation</mat-label>
                    <mat-select formControlName="relation" required>
                      <mat-option *ngFor="let relation of guardianRelations" [value]="relation">{{relation}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Name</mat-label>
                    <input matInput formControlName="name" required>
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Phone</mat-label>
                    <input matInput formControlName="phone" required>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Alternate Phone</mat-label>
                    <input matInput formControlName="alternatePhone">
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Email</mat-label>
                    <input matInput type="email" formControlName="email">
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Occupation</mat-label>
                    <input matInput formControlName="occupation">
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Annual Income</mat-label>
                    <input matInput formControlName="annualIncome">
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Education</mat-label>
                    <input matInput formControlName="education">
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Aadhar Number</mat-label>
                    <input matInput formControlName="aadharNo">
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>PAN Number</mat-label>
                    <input matInput formControlName="panNo">
                  </mat-form-field>
                  <mat-checkbox formControlName="isPrimary" style="flex: 1; margin-top: 16px;">
                    Primary Contact
                  </mat-checkbox>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <button mat-raised-button color="accent" type="button" (click)="addGuardian()" style="margin-top: 16px;">
          <mat-icon>add</mat-icon>
          Add Guardian
        </button>
      </mat-expansion-panel>

      <!-- Address Information -->
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Address Information</mat-panel-title>
        </mat-expansion-panel-header>
        
        <div formArrayName="addresses">
          <div *ngFor="let address of addresses.controls; let i = index" [formGroupName]="i" class="address-section">
            <mat-card>
              <mat-card-header>
                <mat-card-title>Address {{i + 1}}</mat-card-title>
                <button mat-icon-button color="warn" type="button" (click)="removeAddress(i)" *ngIf="addresses.length > 0">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-header>
              <mat-card-content>
                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Address Type</mat-label>
                    <mat-select formControlName="addressType" required>
                      <mat-option *ngFor="let type of addressTypes" [value]="type">{{type}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Address Line 1</mat-label>
                    <input matInput formControlName="line1" required>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Address Line 2</mat-label>
                    <input matInput formControlName="line2">
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>City</mat-label>
                    <input matInput formControlName="city" required>
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>State</mat-label>
                    <mat-select formControlName="state" required>
                      <mat-option *ngFor="let state of indianStates" [value]="state">{{state}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Pincode</mat-label>
                    <input matInput formControlName="pincode" required>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Country</mat-label>
                    <input matInput formControlName="country" required>
                  </mat-form-field>
                  <mat-form-field appearance="outline" style="flex: 1;">
                    <mat-label>Landmark</mat-label>
                    <input matInput formControlName="landmark">
                  </mat-form-field>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <button mat-raised-button color="accent" type="button" (click)="addAddress()" style="margin-top: 16px;">
          <mat-icon>add</mat-icon>
          Add Address
        </button>
      </mat-expansion-panel>

      <div class="action-buttons">
        <button mat-raised-button color="primary" type="submit" [disabled]="studentForm.invalid">
          <mat-icon>save</mat-icon>
          {{ isEditMode ? 'Update' : 'Create' }}
        </button>
        <button mat-raised-button type="button" (click)="onCancel()">
          <mat-icon>cancel</mat-icon>
          Cancel
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
